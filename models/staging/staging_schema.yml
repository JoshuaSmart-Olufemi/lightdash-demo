version: 2

models: 
  - name: stg_customer_orders
    description: a raw table representing the orders of customers over time
    columns: 
      - name: customer_id
        meta:
          metrics:
            count_of_customers: 
              label: 'total number of customers'
              type: count
      - name: order_id
        meta:
          metrics:
            count_of_orders:
              label: 'total number of orders'
              type: count
      - name: order_date
        meta:
          dimension:
            type: date
            time_intervals: ['DAY', 'WEEK', 'MONTH', 'QUARTER']

          additional_dimensions:
            years_since_cohort:
              type: number
              sql: " date_diff(current_date(), ${order_date}, year) "
            
            months_since_cohort:
              type: number
              sql: " date_diff(current_date(), ${order_date}, month) "

            quarters_since_cohort:
              type: number
              sql: " date_diff(current_date(), ${order_date}, quarter) "
          
          

      - name: revenue
        meta:
          metrics:
            sum_revenue:
              label: 'sum of revenue'
              type: sum
            average_order_value:
              label: 'average order value'
              type: number
              sql: " ${sum_revenue} / ${count_of_orders} "

  - name: stg_time_bw_transactions 
    description: a raw table representing the orders of customers over time
    columns: 
      - name: days_between_transactions
        meta:
          metrics:
            average_days_between_transactions:
              type: average
    